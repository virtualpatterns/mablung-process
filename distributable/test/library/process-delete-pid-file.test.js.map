{"version":3,"sources":["../../../source/test/library/process-delete-pid-file.test.js"],"names":["FileSystem","Test","WorkerClient","Process","PidFileNotExistsProcessError","Require","_createRequire","import","meta","url","before","test","context","basePath","ensureDir","serial","path","createPidFile","deletePidFile","false","pathExists","true","throws","worker","resolve","module","exit"],"mappings":";AAAA,OAAOA,UAAP,MAAuB,UAAvB;AACA,OAAOC,IAAP,MAAiB,KAAjB;AACA,SAASC,YAAT,QAA6B,iCAA7B;AAEA,SAASC,OAAT,EAAkBC,4BAAlB,QAAsD,gBAAtD;;AAEA,MAAMC,OAAO,GANbC,cAAc,CAACC,MAAM,CAACC,IAAP,CAAYC,GAAb,CAMd;;AAEAR,IAAI,CAACS,MAAL,CAAY,MAAOC,IAAP,IAAgB;AAC1BA,EAAAA,IAAI,CAACC,OAAL,CAAaC,QAAb,GAAwB,6BAAxB;AACA,QAAMb,UAAU,CAACc,SAAX,CAAqBH,IAAI,CAACC,OAAL,CAAaC,QAAlC,CAAN;AACD,CAHD;AAKAZ,IAAI,CAACc,MAAL,CAAY,uEAAZ,EAAqF,MAAOJ,IAAP,IAAgB;AAEnG,MAAIK,IAAI,GAAI,GAAEL,IAAI,CAACC,OAAL,CAAaC,QAAS,YAApC;AAEAV,EAAAA,OAAO,CAACc,aAAR,CAAsBD,IAAtB;AACAb,EAAAA,OAAO,CAACe,aAAR;AAEAP,EAAAA,IAAI,CAACQ,KAAL,CAAW,MAAMnB,UAAU,CAACoB,UAAX,CAAsBJ,IAAtB,CAAjB;AAED,CATD;AAWAf,IAAI,CAACc,MAAL,CAAY,kEAAZ,EAAgF,MAAOJ,IAAP,IAAgB;AAE9F,MAAIK,IAAI,GAAI,GAAEL,IAAI,CAACC,OAAL,CAAaC,QAAS,aAApC;AAEAV,EAAAA,OAAO,CAACc,aAAR,CAAsBD,IAAtB;AACAb,EAAAA,OAAO,CAACe,aAAR;AACAf,EAAAA,OAAO,CAACc,aAAR,CAAsBD,IAAtB;;AAEA,MAAI;AACFL,IAAAA,IAAI,CAACU,IAAL,CAAU,MAAMrB,UAAU,CAACoB,UAAX,CAAsBJ,IAAtB,CAAhB;AACD,GAFD,SAEU;AACRb,IAAAA,OAAO,CAACe,aAAR;AACD;AAEF,CAdD;AAgBAjB,IAAI,CAACc,MAAL,CAAY,2CAAZ,EAA0DJ,IAAD,IAAU;AAEjE,MAAIK,IAAI,GAAI,GAAEL,IAAI,CAACC,OAAL,CAAaC,QAAS,YAApC;AAEAV,EAAAA,OAAO,CAACc,aAAR,CAAsBD,IAAtB;AACAb,EAAAA,OAAO,CAACe,aAAR;AAEAP,EAAAA,IAAI,CAACW,MAAL,CAAY,MAAMnB,OAAO,CAACe,aAAR,EAAlB,EAA2C;AAAE,kBAAcd;AAAhB,GAA3C;AAED,CATD;AAWAH,IAAI,CAACc,MAAL,CAAY,6CAAZ,EAA2D,MAAOJ,IAAP,IAAgB;AAEzE,MAAIK,IAAI,GAAI,GAAEL,IAAI,CAACC,OAAL,CAAaC,QAAS,aAApC;AACA,MAAIU,MAAM,GAAG,IAAIrB,YAAJ,CAAiBG,OAAO,CAACmB,OAAR,CAAgB,aAAhB,CAAjB,CAAb;;AAEA,MAAI;AAEF,UAAMD,MAAM,CAACE,MAAP,CAAcR,aAAd,CAA4BD,IAA5B,CAAN;AACA,UAAMO,MAAM,CAACE,MAAP,CAAcP,aAAd,EAAN;AAEAP,IAAAA,IAAI,CAACQ,KAAL,CAAW,MAAMnB,UAAU,CAACoB,UAAX,CAAsBJ,IAAtB,CAAjB;AAED,GAPD,SAOU;AACR,UAAMO,MAAM,CAACG,IAAP,EAAN;AACD;AAEF,CAhBD","sourcesContent":["import FileSystem from 'fs-extra'\nimport Test from 'ava'\nimport { WorkerClient } from '@virtualpatterns/mablung-worker'\n\nimport { Process, PidFileNotExistsProcessError } from '../../index.js'\n\nconst Require = __require\n\nTest.before(async (test) => {\n  test.context.basePath = 'process/pid/delete-pid-file'\n  await FileSystem.ensureDir(test.context.basePath)\n})\n\nTest.serial('Process.deletePidFile() when called after Process.createPidFile(path)', async (test) => {\n\n  let path = `${test.context.basePath}/after.pid`\n\n  Process.createPidFile(path)\n  Process.deletePidFile()\n\n  test.false(await FileSystem.pathExists(path))\n\n})\n\nTest.serial('Process.deletePidFile() when called before another createPidFile', async (test) => {\n\n  let path = `${test.context.basePath}/before.pid`\n\n  Process.createPidFile(path)\n  Process.deletePidFile()\n  Process.createPidFile(path)\n\n  try {\n    test.true(await FileSystem.pathExists(path))\n  } finally {\n    Process.deletePidFile()\n  }\n\n})\n\nTest.serial('Process.deletePidFile() when called twice', (test) => {\n\n  let path = `${test.context.basePath}/twice.pid`\n\n  Process.createPidFile(path)\n  Process.deletePidFile()\n\n  test.throws(() => Process.deletePidFile(), { 'instanceOf': PidFileNotExistsProcessError })\n\n})\n\nTest.serial('Process.deletePidFile() when using a worker', async (test) => {\n\n  let path = `${test.context.basePath}/worker.pid`\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  try {\n\n    await worker.module.createPidFile(path)\n    await worker.module.deletePidFile()\n\n    test.false(await FileSystem.pathExists(path))\n  \n  } finally {\n    await worker.exit()\n  }\n\n})\n"],"file":"process-delete-pid-file.test.js"}